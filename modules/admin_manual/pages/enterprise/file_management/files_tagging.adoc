= Advanced File Tagging With the Workflow App
:toc: right

== Introduction

The Workflow App provides advanced management of file tagging. The app
has three parts: Tag Manager, Automatic Tagging, and Retention.

The Workflow App should be enabled by default (Apps page), and the three
configuration modules visible on your ownCloud Admin page.

See xref:user_manual:files/webgui/tagging.adoc[Tagging Files] in the ownCloud User manual to
learn how to apply and filter tags on files.

== Tag Manager

[TIP]
====
To use this functionality, administrators need to install and enable the *Collaborative Tag Management* app from Market.
====

The Tag Manager is for creating new tags, editing existing tags, and deleting tags. 
Tags may be marked as *Visible*, *Static*, *Restricted*, or *Invisible*.

Visible:: All users may see, rename, and apply these tags to files and folders.

Static:: Only users in the specified groups can assign and un-assign the tag to a file. However, only admins can rename and edit the tag.

Restricted:: Tags are assignable and editable only to the user groups that you select. 
Other users can filter files by restricted tags, but cannot tag files with them or rename them. 
The tags are marked (restricted).

Invisible:: Tags are visible only to ownCloud admins.

To access this functionality, select menu:Settings[Admin > Workflow &amp; Tags].

image:enterprise/file_management/workflow-1.png[Tag Manager.]

This is an example of what your tags look like in the *Tags* view on your files page.
Non-admin users will not see invisible tags, but they will see visible and restricted tags.

image:enterprise/file_management/workflow-5.png[Tag Manager.]

== Automatic Tagging

The Automatic Tagging module operates on newly-uploaded files. Create a
set of conditions, and then when a file or folder matches those
conditions it is automatically tagged. The tag must already have been
created with the Tag Manager.

For example, you can assign the invisible tag *iOS Uploads* to all files
uploaded from iOS devices. This tag is visible only to admins.

image:enterprise/file_management/workflow-2.png[Automatic tagging.]

When files with this tag are shared with you, you can view them with the
Tags filter on the Files page.

image:enterprise/file_management/workflow-3.png[Viewing tagged files.]

Automatic Tagging is especially useful with the Retention module.

== Retention

The Retention module is your housecleaning power tool because it automatically deletes files after a period that you specify. 
Select which tag to set a time limit on, and then set your time limit. 
File age is calculated using a file's modification time (mtime), the default, or its upload time.

IMPORTANT: ownCloud does not preserve directory mtimes (modification time), though it does update file mtimes.

image:enterprise/file_management/workflow-4.png[Setting retention times via tag.]

For best performance, retention tags should be applied high in your file hierarchy. 
If subfolders have the same tags as their parent folders, their tags must also be processed, so it will take a little longer.

== Retention Engines

Two retention engines further allow for fine-tuning the retention settings: Tag-based, and User-based.

=== Tag-based Retention 

Tag-based retention checks files that have a particular tag assigned. 
Then it checks (depth-first) the children of the tagged item, before continuing with the other tagged items. 
Children that have already been checked will not be checked a second time.
This is optimized for processing smaller numbers of files that have multiple retention tags.

[source,php]
----
'workflow.retention_engine' => tagbased,
----

=== User-based Retention 

User-based retention examines files per user. 
It first iterates over all files and folders (siblings first), then examines the tags for those items and checks their respective retention periods. 
This is optimized for many files with few retention tags.
To use UserBasedRetention, add the following line to your `ee.config.php`:

[source,php]
----
'workflow.retention_engine' => userbased,
----

=== Calculate File Age Using Upload Time 

An administrator can configure the Workflow app to use a file's upload time, instead of its mtime, to calculate the file's age.
This can be done in a `config.php` file or by using the occ `config:system:set` command.

==== Configure Using a config.php File

To use file upload times in a config.php file, add the configuration value in the example below.

[source,php]
----
workflow.tag-based-retention.use-upload-time
----

==== Configure using OCC Commands

To use file upload times using the occ `config:system:set` command, run the command in the example below.

[source,console]
----
{occ-command-example-prefix} config:system:set workflow.tag-based-retention.use-upload-time \
  --type boolean \
  --value true
----

TIP: Setting `workflow.tag-based-retention.use-upload-time` to true will use mtimes instead of upload times.
